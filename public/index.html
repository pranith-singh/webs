<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holographic 3D Dashboard</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: radial-gradient(circle at 30% 30%, #0f0c29, #302b63, #24243e);
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  min-height: 100vh;
  padding: 30px;
  perspective: 1500px;
  overflow-x: hidden;
}

h1,h3 { text-shadow: 0 0 15px rgba(0,255,255,0.4),0 0 30px rgba(0,200,255,0.3); }

.card {
  background: rgba(0, 0, 0, 0.4);
  border-radius: 20px;
  backdrop-filter: blur(15px);
  transform-style: preserve-3d;
  transition: transform 0.1s ease, box-shadow 0.2s ease;
  box-shadow: 0 0 20px rgba(0,255,255,0.2),0 0 40px rgba(0,255,255,0.1) inset;
}

.card:hover { box-shadow: 0 25px 60px rgba(0,255,255,0.5),0 0 60px rgba(0,255,255,0.2) inset; }

.form-control { background: rgba(255,255,255,0.1); border: none; color: #fff; }
.form-control::placeholder { color: rgba(255,255,255,0.6); }

.btn-success {
  background: linear-gradient(90deg,#00ffea,#0066ff);
  border:none;color:#000;font-weight:bold;text-transform:uppercase;transition:0.3s;
  box-shadow: 0 0 10px rgba(0,255,255,0.5);
}
.btn-success:hover { background: linear-gradient(90deg,#0066ff,#00ffea); color:#fff; transform:scale(1.05); box-shadow:0 0 20px #00ffff; }

#usersTable th { background: linear-gradient(90deg,#00ffea,#0066ff); color:#000; }
#usersTable td { transition: 0.3s transform, 0.3s background, 0.3s box-shadow; }
#usersTable tbody tr:hover { transform: translateZ(15px) rotateY(5deg); background: rgba(0,255,255,0.1); box-shadow: 0 0 15px #00ffff; }

.alert { backdrop-filter: blur(5px); border-radius: 10px; font-weight:bold; }

.particle { position:absolute; width:4px; height:4px; background:#00ffff; border-radius:50%; animation: float 10s linear infinite; opacity:0.6; }
@keyframes float {0%{transform:translateY(0) translateX(0);opacity:0.6}50%{transform:translateY(-500px) translateX(100px);opacity:1}100%{transform:translateY(-1000px) translateX(0);opacity:0.6}}

.chart-container { perspective:1200px; display:flex; justify-content:center; margin-top:20px; }

#rolesChart { transform-style: preserve-3d; transition: transform 0.1s ease; filter: drop-shadow(0 0 15px #00ffff); }
</style>
</head>
<body>

<div id="particles"></div>

<div class="container">
  <h1 class="text-center mb-4 animate__animated animate__fadeInDown">üöÄ User Dashboard</h1>

  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-lg animate__animated animate__fadeInLeft" id="formCard">
        <div class="card-body">
          <h3 class="mb-3">‚ûï Add User</h3>
          <form id="userForm" class="row g-3">
            <div class="col-md-6"><input type="text" id="name" class="form-control" placeholder="Full Name" required></div>
            <div class="col-md-6"><input type="email" id="email" class="form-control" placeholder="Email" required></div>
            <div class="col-md-6"><input type="text" id="phone" class="form-control" placeholder="Phone"></div>
            <div class="col-md-6"><input type="text" id="city" class="form-control" placeholder="City"></div>
            <div class="col-md-12"><input type="text" id="role" class="form-control" placeholder="Role / Job Title"></div>
            <div class="col-md-12 d-grid"><button type="submit" class="btn btn-success">Save User</button></div>
          </form>
          <div id="messageArea" class="mt-3"></div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-lg animate__animated animate__fadeInRight" id="tableCard">
        <div class="card-body">
          <h3 class="mb-3">üìã Users</h3>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="usersTable">
              <thead>
                <tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>City</th><th>Role</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-lg animate__animated animate__fadeInUp" id="chartCard">
    <div class="card-body">
      <h3 class="mb-3">üìä Roles Distribution</h3>
      <div class="chart-container">
        <canvas id="rolesChart"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const particlesContainer=document.getElementById('particles');
for(let i=0;i<50;i++){const p=document.createElement('div');p.classList.add('particle');p.style.left=Math.random()*window.innerWidth+'px';p.style.top=Math.random()*window.innerHeight+'px';p.style.animationDuration=5+Math.random()*10+'s';particlesContainer.appendChild(p);}

const form=document.getElementById("userForm");
const msgArea=document.getElementById("messageArea");
const usersTableBody=document.querySelector("#usersTable tbody");
const chartCanvas=document.getElementById("rolesChart");
let rolesChart;

async function loadUsers(){
  const res=await fetch("/db");
  const users=await res.json();
  usersTableBody.innerHTML="";
  users.forEach(u=>{
    usersTableBody.innerHTML+=`<tr class="animate__animated animate__fadeIn">
      <td>${u.Id}</td><td>${u.Name}</td><td>${u.Email}</td><td>${u.Phone||""}</td><td>${u.City||""}</td><td>${u.Role||""}</td>
    </tr>`;
  });
  updateChart(users);
}

function updateChart(users){
  const counts={};
  users.forEach(u=>counts[u.Role||"Unknown"]=(counts[u.Role||"Unknown"]||0)+1);
  const ctx=chartCanvas.getContext("2d");
  if(rolesChart) rolesChart.destroy();

  const neonColors=['#00ffff','#ff00ff','#00ff00','#ffff00','#ff0000','#00aaff','#aa00ff'];

  rolesChart=new Chart(ctx,{
    type:'pie',
    data:{labels:Object.keys(counts),datasets:[{data:Object.values(counts),backgroundColor:neonColors,borderColor:'#00ffff',borderWidth:2}]},
    options:{plugins:{legend:{labels:{color:'#00ffff',font:{size:14,weight:'bold'}}}}}
  });
}

form.addEventListener("submit",async e=>{
  e.preventDefault();
  const user={name:document.getElementById("name").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value,city:document.getElementById("city").value,role:document.getElementById("role").value};
  const res=await fetch("/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(user)});
  msgArea.innerHTML="";
  if(res.ok){msgArea.innerHTML=`<div class="alert alert-success animate__animated animate__fadeIn">‚úÖ User saved!</div>`;form.reset();loadUsers();}
  else{msgArea.innerHTML=`<div class="alert alert-danger animate__animated animate__fadeIn">‚ùå Failed to save user</div>`;}
  setTimeout(()=>msgArea.innerHTML="",3000);
});

loadUsers();

// Holographic 3D mouse tilt effect
const cards=[document.getElementById('formCard'),document.getElementById('tableCard'),document.getElementById('chartCard')];
document.addEventListener('mousemove',e=>{
  const x=(window.innerWidth/2-e.clientX)/20;
  const y=(window.innerHeight/2-e.clientY)/20;
  cards.forEach(c=>{c.style.transform=`rotateY(${x}deg) rotateX(${y}deg) translateZ(0)`;});
  chartCanvas.style.transform=`rotateY(${x*2}deg) rotateX(${y*2}deg)`;
});
</script>
</body>
</html>
